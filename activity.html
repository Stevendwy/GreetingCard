<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>零零汽陪你走过的2017</title>
  <link rel="preload" href="static/img/icon_music1.png" as="image">
  <link rel="stylesheet" href="static/css/activity.css">
</head>

<body>
  <aside class="music-box">
    <label class="music-label">
      <input type="checkbox" checked id="music-select">
      <div id="music" onclick="clickMusic()">
        <img class="note" src="static/img/p_note.png" alt="note" height="11">
      </div>
    </label>
    <audio id="bgm" loop autoplay src="static/audio/bgm.mp3">您的浏览器不支持音频播放插件标签。</audio>
  </aside>
  <aside class="qr-box">
    <section class="qr">
      <img src="static/img/qr.png" alt="二维码" width="60">
      <span class="remind">零零汽</span>
    </section>
    <div class="pull"></div>
  </aside>
  <section id="activitys">
    <section class="activity">
      <img class="backInner" src="static/img/p_1.png" alt="backInner">
      <img class="back" src="static/img/back.png" alt="back">
      <section class="content">
        <span>
          <span class="blue">2017</span>年<span class="blue" id="month"></span>月<span class="blue" id="day"></span>日开始</span>
        <span>零零汽陪你度过了<span class="yellow" id="day_count"></span>个日日夜夜</span>
        <span>这一年,</span>
        <span>你最早<span class="green" id="morning"></span>上班</span>
        <span>最晚<span class="red" id="evening"></span>下班</span>
      </section>
    </section>
    <section class="activity">
      <img class="backInner" src="static/img/p_2.png" alt="backInner">
      <img class="back" src="static/img/back.png" alt="back">
      <section class="content">
        <span>这一年，你总共查询了</span>
        <span>
          <span class="yellow" id="vins"></span>个车架号</span>
        <span>
          <span class="green" id="modles"></span>个车型</span>
        <span>
          <span class="blue" id="parts"></span>个零件号</span>
        <span>你的区域排名<span class="red" id="orders"></span>名</span>
      </section>
    </section>
    <section class="activity">
      <img class="backInner" src="static/img/p_3.png" alt="backInner">
      <img class="back" src="static/img/back.png" alt="back">
      <section class="content">
        <span>
          <span class="blue">2017</span>年，你查询的配件总额</span>
        <span>
          <span class="yellow" id="all"></span>
        </span>
        <span>其中最贵的配件金额</span>
        <span>
          <span class="green" id="total"></span>
        </span>
        <span>也许你是一个隐藏的富豪～</span>
      </section>
    </section>
    <section class="activity">
      <img class="back" src="static/img/back.png" alt="back">
      <section class="content">
        <span>原来你是<span class="blue" id="brand">奔驰</span>汽配专家！</span>
        <span>我对你的敬仰如滔滔江水～</span>
      </section>
      <div id="echarts"></div>
    </section>
    <section class="activity">
      <img class="back" src="static/img/back.png" alt="back">
      <section class="content full">
        <img class="red-pack" src="static/img/p_red.png" alt="红包">
        <a class="red" style="text-decoration: none;" href="share.html">查看我的年度头衔</a>
      </section>
    </section>
  </section>

  <script src="static/js/activity.js"></script>
  <script src="static/js/echarts.min.js"></script>
  <script>
    var bgm = document.querySelector('#bgm')
    function clickMusic() {
      if (bgm.paused) bgm.play()
      else bgm.pause()
    }

    var xhr = new XMLHttpRequest()
    xhr.onreadystatechange = function () {
      if (this.readyState === 4 && this.status === 200) {
        buildData(JSON.parse(this.response).data)
      }
    }
    xhr.open("GET", "/activity/reports/data")
    xhr.send()

    function buildData(data) {
      var month = document.querySelector("#month")
      var day = document.querySelector("#day")
      var day_count = document.querySelector("#day_count")
      var morning = document.querySelector("#morning")
      var evening = document.querySelector("#evening")
      var vins = document.querySelector("#vins")
      var modles = document.querySelector("#modles")
      var parts = document.querySelector("#parts")
      var orders = document.querySelector("#orders")
      var all = document.querySelector("#all")
      var total = document.querySelector("#total")
      var brand = document.querySelector("#brand")

      data.forEach((item, index) => {
        switch (index) {
          case 0:
            var register_date = item.register_date
            month.innerText = register_date[1]
            day.innerText = register_date[2]
            day_count.innerText = item.days
            morning.innerText = item.earliest
            evening.innerText = item.latest
            break
          case 1:
            vins.innerText = item.vins
            modles.innerText = item.modles
            parts.innerText = item.parts
            orders.innerText = item.orders
            break
          case 2:
            all.innerText = "¥" + item.max.toLocaleString()
            total.innerText = "¥" + item.money_total.toLocaleString()
            break
          case 3:
            brand.innerText = item.brand_cn

            // 制作 Echarts
            var echartsData = item.detail.map(detailItem => {
              return {
                value: detailItem.percent,
                name: detailItem.name
              }
            })
            var myChart = echarts.init(document.getElementById('echarts'));
            // 绘制图表
            myChart.setOption({
              series: [
                {
                  type: 'pie',
                  radius: [30, 110],
                  center: ['50%', '50%'],
                  roseType: 'area',
                  data: echartsData // value/name
                }
              ]
            })
            break
          default: ;
        }
      })
    }
  </script>
</body>

</html>